<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FlowCommon</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item expanded "><a href="../../../src/abstract/index.html">❱ abstract</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/abstract/FlowCommon.sol/error.BadMinStackLength.html">BadMinStackLength</a></li><li class="chapter-item expanded "><a href="../../../src/abstract/FlowCommon.sol/abstract.FlowCommon.html" class="active">FlowCommon</a></li><li class="chapter-item "><a href="../../../src/abstract/FlowCommon.sol/constants.FlowCommon.html">FlowCommon constants</a></li></ol></li><li class="chapter-item "><a href="../../../src/concrete/index.html">❱ concrete</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/concrete/basic/index.html">❱ basic</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/concrete/basic/Flow.sol/contract.Flow.html">Flow</a></li><li class="chapter-item "><a href="../../../src/concrete/basic/Flow.sol/constants.Flow.html">Flow constants</a></li></ol></li><li class="chapter-item "><a href="../../../src/concrete/erc1155/index.html">❱ erc1155</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/concrete/erc1155/FlowERC1155.sol/contract.FlowERC1155.html">FlowERC1155</a></li><li class="chapter-item "><a href="../../../src/concrete/erc1155/FlowERC1155.sol/constants.FlowERC1155.html">FlowERC1155 constants</a></li></ol></li><li class="chapter-item "><a href="../../../src/concrete/erc20/index.html">❱ erc20</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/concrete/erc20/FlowERC20.sol/contract.FlowERC20.html">FlowERC20</a></li><li class="chapter-item "><a href="../../../src/concrete/erc20/FlowERC20.sol/constants.FlowERC20.html">FlowERC20 constants</a></li></ol></li><li class="chapter-item "><a href="../../../src/concrete/erc721/index.html">❱ erc721</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/concrete/erc721/FlowERC721.sol/contract.FlowERC721.html">FlowERC721</a></li><li class="chapter-item "><a href="../../../src/concrete/erc721/FlowERC721.sol/constants.FlowERC721.html">FlowERC721 constants</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../src/interface/index.html">❱ interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/interface/deprecated/index.html">❱ deprecated</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/index.html">❱ v1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC1155V1.sol/struct.FlowERC1155Config.html">FlowERC1155Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC1155V1.sol/struct.ERC1155SupplyChange.html">ERC1155SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC1155V1.sol/struct.FlowERC1155IO.html">FlowERC1155IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC1155V1.sol/interface.IFlowERC1155V1.html">IFlowERC1155V1</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC20V1.sol/struct.ERC20SupplyChange.html">ERC20SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC20V1.sol/struct.FlowERC20IO.html">FlowERC20IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC20V1.sol/struct.FlowERC20Config.html">FlowERC20Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC20V1.sol/interface.IFlowERC20V1.html">IFlowERC20V1</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC721V1.sol/struct.FlowERC721Config.html">FlowERC721Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC721V1.sol/struct.ERC721SupplyChange.html">ERC721SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC721V1.sol/struct.FlowERC721IO.html">FlowERC721IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowERC721V1.sol/interface.IFlowERC721V1.html">IFlowERC721V1</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.FlowConfig.html">FlowConfig</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.NativeTransfer.html">NativeTransfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.ERC20Transfer.html">ERC20Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.ERC721Transfer.html">ERC721Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.ERC1155Transfer.html">ERC1155Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/struct.FlowTransfer.html">FlowTransfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v1/IFlowV1.sol/interface.IFlowV1.html">IFlowV1</a></li></ol></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/index.html">❱ v2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC1155V2.sol/struct.FlowERC1155Config.html">FlowERC1155Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC1155V2.sol/struct.ERC1155SupplyChange.html">ERC1155SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC1155V2.sol/struct.FlowERC1155IO.html">FlowERC1155IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC1155V2.sol/interface.IFlowERC1155V2.html">IFlowERC1155V2</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC20V2.sol/struct.ERC20SupplyChange.html">ERC20SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC20V2.sol/struct.FlowERC20IO.html">FlowERC20IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC20V2.sol/struct.FlowERC20Config.html">FlowERC20Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC20V2.sol/interface.IFlowERC20V2.html">IFlowERC20V2</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC721V2.sol/struct.FlowERC721Config.html">FlowERC721Config</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC721V2.sol/struct.ERC721SupplyChange.html">ERC721SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC721V2.sol/struct.FlowERC721IO.html">FlowERC721IO</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowERC721V2.sol/interface.IFlowERC721V2.html">IFlowERC721V2</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.FlowConfig.html">FlowConfig</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.NativeTransfer.html">NativeTransfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.ERC20Transfer.html">ERC20Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.ERC721Transfer.html">ERC721Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.ERC1155Transfer.html">ERC1155Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/struct.FlowTransfer.html">FlowTransfer</a></li><li class="chapter-item "><a href="../../../src/interface/deprecated/v2/IFlowV2.sol/interface.IFlowV2.html">IFlowV2</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../src/interface/unstable/index.html">❱ unstable</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC1155V4.sol/struct.FlowERC1155ConfigV2.html">FlowERC1155ConfigV2</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC1155V4.sol/interface.IFlowERC1155V4.html">IFlowERC1155V4</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC20V4.sol/struct.FlowERC20ConfigV2.html">FlowERC20ConfigV2</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC20V4.sol/interface.IFlowERC20V4.html">IFlowERC20V4</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC721V4.sol/error.BurnerNotOwner.html">BurnerNotOwner</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC721V4.sol/struct.FlowERC721ConfigV2.html">FlowERC721ConfigV2</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowERC721V4.sol/interface.IFlowERC721V4.html">IFlowERC721V4</a></li><li class="chapter-item "><a href="../../../src/interface/unstable/IFlowV4.sol/interface.IFlowV4.html">IFlowV4</a></li></ol></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC1155V3.sol/struct.FlowERC1155Config.html">FlowERC1155Config</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC1155V3.sol/struct.ERC1155SupplyChange.html">ERC1155SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC1155V3.sol/struct.FlowERC1155IOV1.html">FlowERC1155IOV1</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC1155V3.sol/interface.IFlowERC1155V3.html">IFlowERC1155V3</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC1155V3.sol/constants.IFlowERC1155V3.html">IFlowERC1155V3 constants</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC20V3.sol/struct.ERC20SupplyChange.html">ERC20SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC20V3.sol/struct.FlowERC20IOV1.html">FlowERC20IOV1</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC20V3.sol/struct.FlowERC20Config.html">FlowERC20Config</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC20V3.sol/interface.IFlowERC20V3.html">IFlowERC20V3</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC20V3.sol/constants.IFlowERC20V3.html">IFlowERC20V3 constants</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC721V3.sol/struct.FlowERC721Config.html">FlowERC721Config</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC721V3.sol/struct.ERC721SupplyChange.html">ERC721SupplyChange</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC721V3.sol/struct.FlowERC721IOV1.html">FlowERC721IOV1</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC721V3.sol/interface.IFlowERC721V3.html">IFlowERC721V3</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowERC721V3.sol/constants.IFlowERC721V3.html">IFlowERC721V3 constants</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/error.UnregisteredFlow.html">UnregisteredFlow</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/error.UnsupportedNativeFlow.html">UnsupportedNativeFlow</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/error.UnsupportedERC20Flow.html">UnsupportedERC20Flow</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/error.UnsupportedERC721Flow.html">UnsupportedERC721Flow</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/error.UnsupportedERC1155Flow.html">UnsupportedERC1155Flow</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/struct.FlowConfig.html">FlowConfig</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/struct.ERC20Transfer.html">ERC20Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/struct.ERC721Transfer.html">ERC721Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/struct.ERC1155Transfer.html">ERC1155Transfer</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/struct.FlowTransferV1.html">FlowTransferV1</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/interface.IFlowV3.html">IFlowV3</a></li><li class="chapter-item "><a href="../../../src/interface/IFlowV3.sol/constants.IFlowV3.html">IFlowV3 constants</a></li></ol></li><li class="chapter-item "><a href="../../../src/lib/index.html">❱ lib</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/lib/LibFlow.sol/library.LibFlow.html">LibFlow</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rainprotocol/rain.flow" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="flowcommon"><a class="header" href="#flowcommon">FlowCommon</a></h1>
<p><a href="https://github.com/rainprotocol/rain.flow/blob/b93f3e37ffc47aaff2e18f027f6f1a8544f6129f/src/abstract/FlowCommon.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC721Holder, ERC1155Holder, Multicall, ReentrancyGuard, IInterpreterCallerV2, DeployerDiscoverableMetaV2</p>
<p>Common functionality for flows. Largely handles the evaluable
registration and dispatch. Also implementes the necessary interfaces for
a smart contract to receive ERC721 and ERC1155 tokens.
Flow contracts are expected to be deployed via. a proxy/factory as clones
of an implementation contract. This makes flows cheap to deploy and every
flow contract can be initialized with a different set of flows. This gives
strong guarantees that the flow contract is only capable of evaluating
registered flows, and that individual flow contracts cannot collide state
with each other, given a correctly implemented interpreter store. Combining
proxies with rainlang gives us a very powerful and flexible system for
composing flows without significant gas overhead. Typically a flow contract
deployment will cost well under 1M gas, which is very cheap for bespoke
logic, without significant runtime overheads. This allows for new UX patterns
where users can cheaply create many different tools such as NFT mints,
auctions, escrows, etc. and aim to horizontally scale rather than design
monolithic protocols.
This does NOT implement the preview and flow logic directly because each
flow implementation has different requirements for the mint and burn logic
of the flow tokens. In the future, this may be refactored so that a single
flow contract can handle all flows.
<code>FlowCommon</code> is <code>Multicall</code> so it is NOT compatible with receiving ETH. This
is because <code>Multicall</code> uses <code>delegatecall</code> in a loop which reuses <code>msg.value</code>
for each loop iteration, effectively &quot;double spending&quot; the ETH it receives.
This is a known issue with <code>Multicall</code> so in the future, we may refactor
<code>FlowCommon</code> to not use <code>Multicall</code> and instead implement flow batching
directly in the flow contracts.</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="registeredflows"><a class="header" href="#registeredflows">registeredFlows</a></h3>
<p><em>This mapping tracks all flows that are registered at initialization.
This is used to ensure that only registered flows are evaluated.
Inheriting contracts MUST check this mapping before evaluating a flow,
else anons can deploy their own evaluable and drain the contract.
<code>isRegistered</code> will be set to <code>FLOW_IS_REGISTERED</code> for each registered
flow.</em></p>
<pre><code class="language-solidity">mapping(bytes32 evaluableHash =&gt; uint256 isRegistered) internal registeredFlows;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Forwards config to <code>DeployerDiscoverableMetaV2</code> and disables
initializers. The initializers are disabled because inheriting contracts
are expected to implement some kind of initialization logic that is
compatible with cloning via. proxy/factory. Disabling initializers
in the implementation contract forces that the only way to initialize
the contract is via. a proxy, which should also strongly encourage
patterns that <em>atomically</em> clone and initialize via. some factory.</p>
<pre><code class="language-solidity">constructor(bytes32 metaHash, DeployerDiscoverableMetaV2ConstructionConfig memory config)
    DeployerDiscoverableMetaV2(metaHash, config);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>metaHash</code></td><td><code>bytes32</code></td><td>As per <code>DeployerDiscoverableMetaV2</code>.</td></tr>
<tr><td><code>config</code></td><td><code>DeployerDiscoverableMetaV2ConstructionConfig</code></td><td>As per <code>DeployerDiscoverableMetaV2</code>.</td></tr>
</tbody></table>
</div>
<h3 id="flowcommoninit"><a class="header" href="#flowcommoninit">flowCommonInit</a></h3>
<p>Common initialization logic for inheriting contracts. This MUST be
called by inheriting contracts in their initialization logic (and only).</p>
<pre><code class="language-solidity">function flowCommonInit(EvaluableConfigV2[] memory evaluableConfigs, uint256 flowMinOutputs)
    internal
    onlyInitializing;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>evaluableConfigs</code></td><td><code>EvaluableConfigV2[]</code></td><td>The evaluable configs to register at initialization. Each of these represents a flow that defines valid token movements at runtime for the inheriting contract.</td></tr>
<tr><td><code>flowMinOutputs</code></td><td><code>uint256</code></td><td>The minimum number of outputs for each flow. All flows share the same minimum number of outputs for simplicity.</td></tr>
</tbody></table>
</div>
<h3 id="_flowstack"><a class="header" href="#_flowstack">_flowStack</a></h3>
<p>Standard evaluation logic for flows. This includes critical guards to
ensure that only registered flows are evaluated. This is the only
function that inheriting contracts should call to evaluate flows.
The start and end pointers to the stack are returned so that inheriting
contracts can easily scan the stack for sentinels, which is the expected
pattern to determine what token moments are required.</p>
<pre><code class="language-solidity">function _flowStack(Evaluable memory evaluable, uint256[][] memory context)
    internal
    view
    returns (Pointer, Pointer, uint256[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>evaluable</code></td><td><code>Evaluable</code></td><td>The evaluable to evaluate.</td></tr>
<tr><td><code>context</code></td><td><code>uint256[][]</code></td><td>The context to evaluate the evaluable with. The inheriting contract is expected to provide the correct context for the flow, including checking signatures etc.</td></tr>
</tbody></table>
</div>
<h3 id="_flowstack-1"><a class="header" href="#_flowstack-1">_flowStack</a></h3>
<p>TODO merge both flowStack functions into one.</p>
<pre><code class="language-solidity">function _flowStack(Evaluable memory evaluable, uint256[] memory callerContext, SignedContextV1[] memory signedContexts)
    internal
    returns (Pointer, Pointer, uint256[] memory);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="flowinitialized"><a class="header" href="#flowinitialized">FlowInitialized</a></h3>
<p>This event is emitted when a flow is registered at initialization.</p>
<pre><code class="language-solidity">event FlowInitialized(address sender, Evaluable evaluable);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/abstract/FlowCommon.sol/error.BadMinStackLength.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../src/abstract/FlowCommon.sol/constants.FlowCommon.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/abstract/FlowCommon.sol/error.BadMinStackLength.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../src/abstract/FlowCommon.sol/constants.FlowCommon.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
